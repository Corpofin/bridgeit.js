<html>
    <head>
        <title> Tests </title>
        <link rel="stylesheet" href="./node_modules/mocha/mocha.css" />
    </head>
    <body>
    
        <!-- Promise Support -->
        <script src="../node_modules/es6-promise/dist/es6-promise.js"></script>
        <script src="./node_modules/require.js/build/require.js"></script>
        <script>
             if( !("Promise" in window)){
                window.Promise = ES6Promise.Promise;
            }
        </script>
        <script src="../src/bridgeit.js"></script>
        <script src="../src/bridgeit-services.js"></script>

        <h1>BridgeIt Auth Connect Test</h1>

        <h3>Last Active At: <span id="lastActive"></span>

        <h2><a onclick="testConnect()">Connect</a></h2>

        <h3>Connected At: <span id="connectedAt"></span>

        <h2><a onclick="bridget.services.auth.disconnect();">Disconnect</a></h2>

        <h2><a onclick="continueActivity();">Start Continuous Activity</a></h2>

        <h2><a onclick="updateLastActive();">Update Activity</a></h2>

        <script>

        var activityTimeout = 2;
        var activityTimeoutMillis = activityTimeout*1000*60; //10 minutes 

        function testConnect(){
            var accountId       = 'bsrtests';
            var realmId         = 'test';
            var adminId         = 'admin';
            var adminPassword   = 'secretest';
            var host            = 'dev.bridgeit.io';

            var connectedAt = new Date().getTime();
            bridgeit.services.auth.connect({
                    account: accountId,
                    username: adminId,
                    password: adminPassword,
                    host: host,
                    connectionTimeout: activityTimeout
                }).then(function(response){
                    console.log('connect success: ' + JSON.stringify(response));
                    updateLastActive();
                    updateConnectedAt(connectedAt);
                    
                }).catch(function(error){
                    console.log('login failed ' + error);
                });
        }

        function continueActivity(){
            bridgeit.services.auth.updateLastActiveTimestamp();
            updateLastActive();
            setTimeout( continueActivity, activityTimeoutMillis - 200);
        }

        function updateLastActive(){
            bridgeit.services.auth.updateLastActiveTimestamp();
            var lastActive = bridgeit.services.auth.getLastActiveTimestamp();
            var lastActiveDate = new Date();
            lastActiveDate.setTime(lastActive);
            document.getElementById('lastActive').innerHTML = lastActiveDate.toLocaleTimeString();
        }

        function updateConnectedAt(connectedAt){
            var connectedAtDate = new Date();
            connectedAtDate.setTime(connectedAt);
            document.getElementById('connectedAt').innerHTML = connectedAtDate.toLocaleTimeString();
        }
        </script>
        
    </body>
</html>